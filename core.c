/**
 * core.c contains all of the functionality for the core RoadRunner commands, checkin and sleep.
 * @file core.c
 */

#include <core.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>

/**
 * @brief Check in with the RoadRunner command post.
 * @return a Response structure
 */
Response *checkin_command()
{
    Response *rsp = malloc(sizeof(Response));
    // Return "roadrunner checkin" in response                        recheck the response structure
    rsp->msg_len = 20;
    rsp->msg = malloc(rsp->msg_len * sizeof(char));
    strcpy(rsp->msg, "roadrunner checkin\0");
    if (strncmp(rsp->msg, "roadrunner checkin\0", 20) == 0)
    {
        rsp->ret_code = 0;
    }
    else
    {
        rsp->ret_code = 1;
    }
    return rsp;
}

/**
 * @brief Command to have RoadRunner sleep for a specified number of seconds.
 * @param cmd the command structure
 * @return a Response structure
 */
Response *sleep_command(Command *cmd)
{
    // Perform sleep and return base msg with how long the agent was commanded to sleep

    Response *rsp = malloc(sizeof(Response));

    uint32_t len = 0;
    char buffer[50];

    if (cmd->args == NULL)
    {
        len = snprintf(buffer, 50, "arguments provided are NULL");
        rsp->msg = malloc(len + 1);
        sprintf(rsp->msg, "arguments provided are NULL");
        rsp->ret_code = 1;
        rsp->msg_len = len;
        return rsp;
    }
    if (atoi(cmd->args) == 0)
    {
        len = snprintf(buffer, 50, "arguments are not of the correct type");
        rsp->msg = malloc(len + 1);
        sprintf(rsp->msg, "arguments are not of the correct type");
        rsp->ret_code = 1;
        rsp->msg_len = len;
        return rsp;
    }

    sleep(atoi(cmd->args));
    len = snprintf(buffer, 50, "road runner slept for %d second(s)", atoi(cmd->args));
    rsp->ret_code = 0;
    rsp->msg = malloc(len + 1);
    sprintf(rsp->msg, "road runner slept for %d second(s)", atoi(cmd->args));
    rsp->msg_len = len;
    return rsp;
}

